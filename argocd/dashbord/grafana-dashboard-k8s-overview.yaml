apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-k8s-overview
  namespace: monitoring
  labels:
    grafana_dashboard: "1"
data:
  k8s-overview.json: |
    {
      "id": null,
      "title": "Kubernetes Cluster Overview",
      "tags": ["kubernetes","cluster","overview"],
      "timezone": "browser",
      "schemaVersion": 30,
      "version": 1,
      "refresh": "30s",
      "panels": [
        {
          "type": "row",
          "title": "Cluster Resources",
          "collapsed": false,
          "panels": []
        },
        {
          "type": "graph",
          "title": "CPU Usage by Namespace",
          "targets": [
            {
              "expr": "sum(rate(container_cpu_usage_seconds_total{container!=\"\",pod!=\"\"}[5m])) by (namespace)",
              "legendFormat": "{{namespace}}"
            }
          ]
        },
        {
          "type": "graph",
          "title": "Memory Usage by Namespace",
          "targets": [
            {
              "expr": "sum(container_memory_usage_bytes{container!=\"\",pod!=\"\"}) by (namespace)",
              "legendFormat": "{{namespace}}"
            }
          ]
        },
        {
          "type": "piechart",
          "title": "Pods by Status",
          "targets": [
            {
              "expr": "sum(kube_pod_status_phase{phase=\"Running\"})",
              "legendFormat": "Running"
            },
            {
              "expr": "sum(kube_pod_status_phase{phase=\"Pending\"})",
              "legendFormat": "Pending"
            },
            {
              "expr": "sum(kube_pod_status_phase{phase=\"Failed\"})",
              "legendFormat": "Failed"
            }
          ]
        },
        {
          "type": "graph",
          "title": "Node CPU Usage",
          "targets": [
            {
              "expr": "100 - (avg by(instance)(irate(node_cpu_seconds_total{mode=\"idle\"}[5m])) * 100)",
              "legendFormat": "{{instance}}"
            }
          ]
        },
        {
          "type": "graph",
          "title": "Node Memory Usage",
          "targets": [
            {
              "expr": "1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)",
              "legendFormat": "{{instance}}"
            }
          ]
        },
        {
          "type": "graph",
          "title": "Node Disk Usage",
          "targets": [
            {
              "expr": "1 - (node_filesystem_avail_bytes{fstype!=\"tmpfs\"} / node_filesystem_size_bytes{fstype!=\"tmpfs\"})",
              "legendFormat": "{{instance}}"
            }
          ]
        },
        {
          "type": "graph",
          "title": "Network Receive / Transmit",
          "targets": [
            {
              "expr": "rate(node_network_receive_bytes_total[5m])",
              "legendFormat": "{{instance}} - RX"
            },
            {
              "expr": "rate(node_network_transmit_bytes_total[5m])",
              "legendFormat": "{{instance}} - TX"
            }
          ]
        }
      ]
    }

